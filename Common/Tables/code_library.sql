/*




*/

USE [admindb];
GO

IF OBJECT_ID(N'dbo.[code_library]', N'U') IS NULL BEGIN
	CREATE TABLE dbo.[code_library] (
		[script_id] int IDENTITY(1,1) NOT NULL, 
		[library_key] sysname NOT NULL, 
		[file_hash] varchar(64) NOT NULL, 
		[file_path] sysname NOT NULL, 
		[output_encoding] sysname NOT NULL, 
		[code] varbinary(MAX) NOT NULL, 
		CONSTRAINT PK_code_library PRIMARY KEY CLUSTERED ([script_id])
	);

	CREATE NONCLUSTERED INDEX IX_code_library_library_key ON dbo.[code_library] ([library_key]);
END;
GO

IF OBJECT_ID(N'dbo.[code_view]', N'V') IS NULL BEGIN
	EXEC('CREATE VIEW [dbo].[code_view] AS SELECT [code] FROM dbo.[code_library];');
END;

EXEC('TRUNCATE TABLE dbo.[code_library];');

DECLARE @fmtFile varchar(MAX) = N'{version}
1
1       SQLBINARY           0       0       ""   1     code         ""' + CHAR(13) + CHAR(10);

INSERT INTO [dbo].[code_library] ([library_key], [file_hash], [file_path], [output_encoding], [code])
VALUES (N'BCP_FMT_FILE', '', N'C:\Perflogs\lib\code.fmt', N'ANSI', CAST(@fmtFile AS varbinary(MAX)));

DECLARE @code varbinary(MAX) = 0x0300070070C600000B6700006400000064000000000000000100000001000000000000000000000001000000000000000000803F0300000000000000000000000F000080FFFFFFFFFFFFFFFF01000000000000000000000000000000FFFFFFFFFFFFFF7F000000000000000080808000FF000000000000000100000000000000000000000100000000000000010000000100000000000000000000000600000000000000020000000100000001000000640000000100000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000009001905F0100085365676F6520554900003D0000003D000000980000004C0000004C000000980000007A000000FEFFFFFF00000000FF000000010000000000000000000000170000005C0050006100670069006E0067002000460069006C00650028002A0029005C00250020005500730061006700650000FF00000100000000000000000000001C0000005C0050006100670069006E0067002000460069006C00650028002A0029005C00250020005500730061006700650020005000650061006B00FFD70000010000000000000003000000230000005C0050006800790073006900630061006C004400690073006B0028002A0029005C004100760067002E0020004400690073006B0020007300650063002F00520065006100640080800000010000000000000003000000240000005C0050006800790073006900630061006C004400690073006B0028002A0029005C004100760067002E0020004400690073006B0020007300650063002F0057007200690074006500FF0000000100000001000000000000001C0000005C00500072006F0063006500730073006F00720028005F0054006F00740061006C0029005C0025002000430031002000540069006D00650000FF0000010000000100000000000000230000005C00500072006F0063006500730073006F00720028005F0054006F00740061006C0029005C0025002000500072006F0063006500730073006F0072002000540069006D0065000000FF000100000001000000FFFFFFFF2E0000005C00530051004C005300650072007600650072003A0042007500660066006500720020004D0061006E0061006700650072005C00500061006700650020006C00690066006500200065007800700065006300740061006E0063007900FFFF00000100000001000000FEFFFFFF2D0000005C00530051004C005300650072007600650072003A0042007500660066006500720020004D0061006E0061006700650072005C005200650061006400610068006500610064002000700061006700650073002F00730065006300DA70A6000100000001000000000000002F0000005C00530051004C005300650072007600650072003A004C006100740063006800650073005C00410076006500720061006700650020004C006100740063006800200057006100690074002000540069006D006500200028006D007300290000BFFF000100000001000000000000002B0000005C00530051004C005300650072007600650072003A004C006100740063006800650073005C00530075007000650072004C0061007400630068002000440065006D006F00740069006F006E0073002F00730065006300FF00FF000100000001000000000000002C0000005C00530051004C005300650072007600650072003A004C006100740063006800650073005C00530075007000650072004C0061007400630068002000500072006F006D006F00740069006F006E0073002F00730065006300800080000100000001000000FEFFFFFF2D0000005C00530051004C005300650072007600650072003A004C006100740063006800650073005C0054006F00740061006C0020004C006100740063006800200057006100690074002000540069006D006500200028006D0073002900FFD700000100000001000000000000002F0000005C00530051004C005300650072007600650072003A004C006F0063006B00730028005F0054006F00740061006C0029005C004100760065007200610067006500200057006100690074002000540069006D006500200028006D007300290000FFFF000100000001000000FEFFFFFF2A0000005C00530051004C005300650072007600650072003A004C006F0063006B00730028005F0054006F00740061006C0029005C004C006F0063006B002000520065007100750065007300740073002F00730065006300000080000100000001000000FFFFFFFF380000005C00530051004C005300650072007600650072003A004C006F0063006B00730028005F0054006F00740061006C0029005C004C006F0063006B002000540069006D0065006F0075007400730020002800740069006D0065006F007500740020003E002000300029002F00730065006300F5DEB3000100000001000000FFFFFFFF270000005C00530051004C005300650072007600650072003A004C006F0063006B00730028005F0054006F00740061006C0029005C004C006F0063006B002000570061006900740073002F0073006500630000800000010000000100000000000000300000005C00530051004C005300650072007600650072003A004C006F0063006B00730028005F0054006F00740061006C0029005C004E0075006D006200650072002000\
6F006600200044006500610064006C006F0063006B0073002F0073006500630066CDAA000100000001000000FCFFFFFF370000005C00530051004C005300650072007600650072003A004D0065006D006F007200790020004D0061006E0061006700650072005C004700720061006E00740065006400200057006F0072006B007300700061006300650020004D0065006D006F0072007900200028004B0042002900B8860B000100000001000000FCFFFFFF370000005C00530051004C005300650072007600650072003A004D0065006D006F007200790020004D0061006E0061006700650072005C004D006100780069006D0075006D00200057006F0072006B007300700061006300650020004D0065006D006F0072007900200028004B004200290080800000010000000100000000000000330000005C00530051004C005300650072007600650072003A004D0065006D006F007200790020004D0061006E0061006700650072005C004D0065006D006F007200790020004700720061006E007400730020004F00750074007300740061006E00640069006E006700FF0000000100000002000000FCFFFFFF330000005C00530051004C005300650072007600650072003A004D0065006D006F007200790020004D0061006E0061006700650072005C00540061007200670065007400200053006500720076006500720020004D0065006D006F0072007900200028004B004200290000FF00000100000002000000FCFFFFFF320000005C00530051004C005300650072007600650072003A004D0065006D006F007200790020004D0061006E0061006700650072005C0054006F00740061006C00200053006500720076006500720020004D0065006D006F0072007900200028004B00420029000000FF000100000002000000000000002C0000005C00530051004C005300650072007600650072003A00530051004C00200053007400610074006900730074006900630073005C00420061007400630068002000520065007100750065007300740073002F00730065006300FFFF00000100000002000000000000002C0000005C00530051004C005300650072007600650072003A00530051004C00200053007400610074006900730074006900630073005C00530051004C00200041007400740065006E00740069006F006E0020007200610074006500DA70A6000100000002000000000000002E0000005C00530051004C005300650072007600650072003A00530051004C00200053007400610074006900730074006900630073005C00530051004C00200043006F006D00700069006C006100740069006F006E0073002F0073006500630000BFFF00010000000200000000000000310000005C00530051004C005300650072007600650072003A00530051004C00200053007400610074006900730074006900630073005C00530051004C002000520065002D0043006F006D00700069006C006100740069006F006E0073002F007300650063003D0000003D000000980000004C000000000000000100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\
0000000000000100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000;
INSERT INTO [dbo].[code_library] ([library_key], [file_hash], [file_path], [output_encoding], [code])
VALUES (N'MSSQLSERVER_Perfmon', '6D015C0C5097CAC53A680887D03274703B8830D45913D7142A1CF608B413A88E', N'C:\Perflogs\lib\sql.perfmoncfg', N'BINARY', @code);
